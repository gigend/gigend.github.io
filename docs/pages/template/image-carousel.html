<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gigend</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../../styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
</head>

<style>
  /* Container utama - tambahkan aspect ratio 16:9 */
  .carousel-container {
    position: relative;
    overflow: hidden;
    max-width: 100%;
    padding-top: 56.25%; /* 16:9 aspect ratio */
  }
  /* Untuk aspect ratio yang berbeda, Anda bisa mengubah nilai padding-top:
     1:1 → padding-top: 100%
     4:3 → padding-top: 75%
     16:9 → padding-top: 56.25%
     21:9 → padding-top: 42.85% */
  
  /* Carousel slide wrapper - posisi absolut */
  .carousel {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    transition: transform 0.5s ease-in-out;
    user-select: none;
    touch-action: pan-y;
  }
  
  /* Setiap slide - isi penuh container */
  .carousel-slide {
    min-width: 100%;
    height: 100%;
    flex-shrink: 0;
    position: relative;
    width: fit-content;
  }
  
  .carousel-slide img {
    width: 100%;
    height: 100%;
    display: block;
    object-fit: contain; /* Gambar akan menyesuaikan dengan container */
    cursor: pointer;
    touch-action: none; /* Nonaktifkan touch default untuk pinch-to-zoom */
  }
  
  /* Loading spinner */
  .spinner {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 40px;
    height: 40px;
    margin: -20px 0 0 -20px;
    border: 4px solid rgba(0, 0, 0, 0.1);
    border-top-color: #333;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    z-index: 5;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  /* Nomor slide (counter) di pojok kanan atas */
  .slide-counter {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.6);
    color: #fff;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 14px;
    z-index: 10;
  }
  
  /* Tombol navigasi modern - hidden by default */
  .prev-btn,
  .next-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.5);
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: #fff;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 10;
  }
  
  .prev-btn { left: 10px; }
  .next-btn { right: 10px; }
  
  /* Tampilkan tombol navigasi saat hover (desktop) */
  .carousel-container:hover .prev-btn,
  .carousel-container:hover .next-btn {
    opacity: 1;
  }
  
  /* Tombol keluar fullscreen */
  .close-fullscreen {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.5);
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    color: #fff;
    font-size: 24px;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 20;
  }
  
  /* Fullscreen mode adjustments */
  .fullscreen-active .slide-counter {
    left: 50%;
    right: auto;
    transform: translateX(-50%);
  }
  .fullscreen-active .prev-btn,
  .fullscreen-active .next-btn {
    position: fixed; /* Posisi tetap relatif ke layar */
    top: 50%;
    transform: translateY(-50%);
    z-index: 1000;
  }

  @media (hover: none) and (pointer: coarse) {
    .carousel-slide img {
      object-fit: contain;
      touch-action: none;
    }
    
    .fullscreen-active .carousel-slide img {
      width: 100vw;
      height: 100vh;
      object-fit: contain;
    }
    
    .prev-btn,
    .next-btn {
      opacity: 0.7 !important;
      width: 50px;
      height: 50px;
      font-size: 24px;
    }
    
    .prev-btn:active,
    .next-btn:active {
      opacity: 1 !important;
      background: rgba(0, 0, 0, 0.8);
    }
  }
</style>

<body>
  <div class="container">

<!-- Navigation Bar -->
    <div class="navbar">
      <div class="dropdown">
          <a class="dropbtn">Menu <i class="fa-solid fa-caret-down caret-icon"></i></a>
          <div class="dropdown-content">
              <a href="https://gigend.github.io"><i class="fa-solid fa-house"></i> Home</a>
              <a href="https://gigend.blogspot.com/p/content-list.html"><i class="fa-solid fa-list"></i> Content List</a>
              <a href="https://gigend.blogspot.com/p/privacy-policy.html"><i class="fa-solid fa-lock"></i> Privacy Policy</a>
              <a href="javascript:void(0);" id="darkModeToggleNav" title="Toggle Dark Mode"><i class="fa-solid fa-moon"></i> Dark Mode</a>
              <a href="#gacha" onclick="feelingLucky()" title="Gacha konten di blog ini ..."><i class="fa-solid fa-dice"></i> Gacha</a>
              <a href="https://sites.google.com/view/gigend/chat-room"><i class="fa-solid fa-comments"></i> Chat Room</a>
              <a href="https://sites.google.com/view/gigend/waifu"><i class="fa-solid fa-heart"></i> Waifu</a>
              <a href="https://sites.google.com/view/gigend/portfolio"><i class="fa-solid fa-briefcase"></i> Portfolio</a>
              <a href="https://sites.google.com/view/gigend/support"><i class="fa-solid fa-handshake"></i> Support</a>
              <a href="https://sites.google.com/view/gigend/about"><i class="fa-solid fa-circle-info"></i> About</a>
          </div>
      </div>
      <div class="dropdown">
          <a class="dropbtn">Social Media <i class="fa-solid fa-caret-down caret-icon"></i></a>
          <div class="dropdown-content">
              <a href="https://www.hoyolab.com/accountCenter?id=1018336"><i class="fa-solid fa-gamepad"></i> Hoyolab</a>
              <a href="https://pixiv.me/gigend"><i class="fa-solid fa-paintbrush"></i> Pixiv</a>
              <a href="https://facebook.com/gigend"><i class="fa-brands fa-facebook"></i> Facebook</a>
              <a href="https://instagram.com/gigend"><i class="fa-brands fa-instagram"></i> Instagram</a>
              <a href="https://twitter.com/gigend"><i class="fa-brands fa-twitter"></i> Twitter</a>
              <a href="https://tiktok.com/@gigend"><i class="fa-brands fa-tiktok"></i> Tiktok</a>
              <a href="https://soundcloud.com/gigend"><i class="fa-brands fa-soundcloud"></i> Soundcloud</a>
              <a href="http://youtube.com/@gigend"><i class="fa-brands fa-youtube"></i> Youtube</a>
          </div>
      </div>
      <div class="dropdown">
          <a class="single-btn" href="https://sites.google.com/view/gigend/">Archive</a>
      </div>
  </div>

<div class="carousel-container" id="carouselContainer">
  <div class="carousel">
    <!-- Setiap slide dilengkapi dengan spinner -->
    <div class="carousel-slide">
      <div class="spinner"></div>
      <img src="https://placehold.co/360x360?text=Slide-1" alt="Slide 1" loading="lazy" />
    </div>
    <div class="carousel-slide">
      <div class="spinner"></div>
      <img src="https://placehold.co/640x360?text=Slide-2" alt="Slide 2" loading="lazy" />
    </div>
    <div class="carousel-slide">
      <div class="spinner"></div>
      <img src="https://placehold.co/640x360?text=Slide-3" alt="Slide 3" loading="lazy" />
    </div>
    <div class="carousel-slide">
      <div class="spinner"></div>
      <img src="https://placehold.co/640x360?text=Slide-4" alt="Slide 4" loading="lazy" />
    </div>
    <div class="carousel-slide">
      <div class="spinner"></div>
      <img src="https://placehold.co/640x360?text=Slide-5" alt="Slide 5" loading="lazy" />
    </div>
    <div class="carousel-slide">
      <div class="spinner"></div>
      <img src="https://placehold.co/640x360?text=Slide-6" alt="Slide 6" loading="lazy" />
    </div>
    <div class="carousel-slide">
      <div class="spinner"></div>
      <img src="https://placehold.co/640x360?text=Slide-7" alt="Slide 7" loading="lazy" />
    </div>
  </div>
  <!-- Nomor slide -->
  <div class="slide-counter"></div>
  <!-- Tombol navigasi -->
  <button class="prev-btn">&#10094;</button>
  <button class="next-btn">&#10095;</button>
  <!-- Tombol keluar fullscreen -->
  <button class="close-fullscreen" id="closeFullscreen">&times;</button>
</div>
<div class="divider"></div>

<!-- Footer -->
<footer>
  <div class="logo-container">
    <a href="https://sites.google.com/view/gigend/" target="_blank">
      <img src="../../assets/images/gigend-logo-small.png" alt="Logo" class="logo">
    </a>
  </div>
  <p>&copy; 2025 Gigend. All rights reserved.</p>
</footer>
</div>

<script src="../../main.js"></script>
<script>
  (function() {
    const carouselContainer = document.getElementById('carouselContainer');
    const carousel = document.querySelector('.carousel');
    const slides = document.querySelectorAll('.carousel-slide');
    const totalSlides = slides.length;
    const counter = document.querySelector('.slide-counter');
    const prevBtn = document.querySelector('.prev-btn');
    const nextBtn = document.querySelector('.next-btn');
    const closeFullscreenBtn = document.getElementById('closeFullscreen');
    let currentIndex = 0;
    let hideNavTimeout;
    let isZooming = false; // Menandai apakah sedang zooming
    let isPanning = false; // Menandai apakah sedang panning
    let lastTapTime = 0;
    let doubleTapTimeout = null;
    
    // Update nomor slide
    function updateCounter() {
      counter.textContent = (currentIndex + 1) + '/' + totalSlides;
    }
    updateCounter();
    
    // Atur posisi carousel berdasarkan indeks saat ini
    function setPosition() {
      const containerWidth = carouselContainer.offsetWidth;
      carousel.style.transform = `translateX(-${currentIndex * containerWidth}px)`;
    }
    
    // Fungsi navigasi slide
    function nextSlide() {
      if (currentIndex < totalSlides - 1) {
        // Reset transformasi gambar di slide saat ini
        const currentSlide = slides[currentIndex];
        const currentImage = currentSlide.querySelector('img');
        currentImage.currentScale = 1;
        currentImage.currentOffsetX = 0;
        currentImage.currentOffsetY = 0;
        currentImage.style.transform = 'translate(0px, 0px) scale(1)';
        isZoomed = false;

        currentIndex++;
        setPosition();
        updateCounter();
      }
    }

    function prevSlide() {
      if (currentIndex > 0) {
        const currentSlide = slides[currentIndex];
        const currentImage = currentSlide.querySelector('img');
        currentImage.currentScale = 1;
        currentImage.currentOffsetX = 0;
        currentImage.currentOffsetY = 0;
        currentImage.style.transform = 'translate(0px, 0px) scale(1)';
        isZoomed = false;

        currentIndex--;
        setPosition();
        updateCounter();
      }
    }
    nextBtn.addEventListener('click', nextSlide);
    prevBtn.addEventListener('click', prevSlide);
    
    // Implementasi swipe untuk carousel (abaikan jika zoom/pan)
    let startX = 0;
    let currentX = 0;
    let isDragging = false;
    
    function getPositionX(event) {
      return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX;
    }
    
    function touchStart(event) {
      if (isZooming || isPanning) return; // Jangan swipe jika sedang zoom atau panning
      isDragging = true;
      startX = getPositionX(event);
      currentX = startX;
      carousel.style.transition = 'none';
      showNavigation();
    }
    
    function touchMove(event) {
      if (!isDragging || isZooming || isPanning) return;
      currentX = getPositionX(event);
      const diff = currentX - startX;
      const containerWidth = carouselContainer.offsetWidth;
      carousel.style.transform = `translateX(${ -currentIndex * containerWidth + diff }px)`;
    }
    
    function touchEnd() {
      if (!isDragging || isZooming || isPanning) return;
      isDragging = false;
      const containerWidth = carouselContainer.offsetWidth;
      const diff = currentX - startX;
      const swipeThreshold = window.matchMedia("(hover: none)").matches ? 30 : 50;

      if (diff < -swipeThreshold && currentIndex < totalSlides - 1) {
        const currentSlide = slides[currentIndex];
        const currentImage = currentSlide.querySelector('img');
        currentImage.currentScale = 1;
        currentImage.currentOffsetX = 0;
        currentImage.currentOffsetY = 0;
        currentImage.style.transform = 'translate(0px, 0px) scale(1)';
        isZoomed = false;
        currentIndex++;
      }
      if (diff > swipeThreshold && currentIndex > 0) {
        const currentSlide = slides[currentIndex];
        const currentImage = currentSlide.querySelector('img');
        currentImage.currentScale = 1;
        currentImage.currentOffsetX = 0;
        currentImage.currentOffsetY = 0;
        currentImage.style.transform = 'translate(0px, 0px) scale(1)';
        isZoomed = false;
        currentIndex--;
      }

      carousel.style.transition = 'transform 0.5s ease-in-out';
      setPosition();
      updateCounter();
      hideNavigationWithDelay();
    }
    
    carousel.addEventListener('touchstart', touchStart);
    carousel.addEventListener('touchmove', touchMove);
    carousel.addEventListener('touchend', touchEnd);
    carousel.addEventListener('mousedown', touchStart);
    carousel.addEventListener('mousemove', touchMove);
    carousel.addEventListener('mouseup', touchEnd);
    carousel.addEventListener('mouseleave', () => { if (isDragging) touchEnd(); });
    
    window.addEventListener('resize', () => {
      carousel.style.transition = 'none';
      setPosition();
    });
    
    // Menghilangkan spinner setelah gambar selesai dimuat
    const images = document.querySelectorAll('.carousel-slide img');
    images.forEach(img => {
      img.addEventListener('load', function() {
        const spinner = this.parentNode.querySelector('.spinner');
        if (spinner) spinner.style.display = 'none';
      });
      // Inisialisasi properti zoom & offset
      img.currentScale = 1;
      img.currentOffsetX = 0;
      img.currentOffsetY = 0;
    });
    
    // Fungsi fullscreen
    function openFullscreen() {
      if (!document.fullscreenElement) {
        if (carouselContainer.requestFullscreen) {
          carouselContainer.requestFullscreen();
        } else if (carouselContainer.mozRequestFullScreen) {
          carouselContainer.mozRequestFullScreen();
        } else if (carouselContainer.webkitRequestFullscreen) {
          carouselContainer.webkitRequestFullscreen();
        } else if (carouselContainer.msRequestFullscreen) {
          carouselContainer.msRequestFullscreen();
        }
      }
    }
    
    function exitFullscreen() {
      if (document.fullscreenElement) {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      }
      carouselContainer.classList.remove('fullscreen-active');
      closeFullscreenBtn.style.display = 'none';
      images.forEach(img => {
        img.currentScale = 1;
        img.currentOffsetX = 0;
        img.currentOffsetY = 0;
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.transform = 'translate(0px, 0px) scale(1)';
      });
      setPosition();
    }
    
    // Klik gambar untuk masuk fullscreen
    images.forEach(img => {
      img.addEventListener('click', function() {
        openFullscreen();
      });
    });
    
    // Tampilkan tombol keluar fullscreen saat mode fullscreen aktif
    document.addEventListener('fullscreenchange', () => {
      if (document.fullscreenElement) {
        carouselContainer.classList.add('fullscreen-active');
        closeFullscreenBtn.style.display = 'flex';
        images.forEach(img => {
          img.currentScale = 1;
          img.currentOffsetX = 0;
          img.currentOffsetY = 0;
          img.style.width = '100vw';
          img.style.height = '100vh';
          img.style.transform = 'translate(0px, 0px) scale(1)';
        });
      } else {
        carouselContainer.classList.remove('fullscreen-active');
        closeFullscreenBtn.style.display = 'none';
        images.forEach(img => {
          img.style.width = '100%';
          img.style.height = '100%';
          img.style.transform = 'translate(0px, 0px) scale(1)';
        });
        setPosition();
      }
    });
    
    closeFullscreenBtn.addEventListener('click', exitFullscreen);
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (document.fullscreenElement) {
        if (e.key === 'ArrowLeft') prevSlide();
        if (e.key === 'ArrowRight') nextSlide();
      }
    });
    
    // Fungsi untuk menampilkan tombol navigasi
    function showNavigation() {
      prevBtn.style.setProperty('opacity', '1', 'important');
      nextBtn.style.setProperty('opacity', '1', 'important');
      clearTimeout(hideNavTimeout);
      if (document.fullscreenElement && window.matchMedia("(hover: none)").matches) {
        hideNavTimeout = setTimeout(() => {
          prevBtn.style.setProperty('opacity', '0', 'important');
          nextBtn.style.setProperty('opacity', '0', 'important');
        }, 100);
      } else if (window.matchMedia("(hover: none)").matches) {
        hideNavTimeout = setTimeout(() => {
          prevBtn.style.setProperty('opacity', '0.7', 'important');
          nextBtn.style.setProperty('opacity', '0.7', 'important');
        }, 2000);
      }
    }
    
    function hideNavigationWithDelay() {
      clearTimeout(hideNavTimeout);
      hideNavTimeout = setTimeout(() => {
        prevBtn.style.setProperty('opacity', '0', 'important'); 
        nextBtn.style.setProperty('opacity', '0', 'important');
      }, 100);
    }
    
    carouselContainer.addEventListener('mouseenter', showNavigation);
    carouselContainer.addEventListener('mouseleave', hideNavigationWithDelay);
    carouselContainer.addEventListener('touchstart', showNavigation);
    carouselContainer.addEventListener('mousemove', showNavigation);
    carouselContainer.addEventListener('touchend', hideNavigationWithDelay);
    carousel.addEventListener('touchstart', showNavigation);
    carousel.addEventListener('touchend', hideNavigationWithDelay);
    
    window.onload = function() {
      if (window.matchMedia("(hover: none)").matches) {
        showNavigation();
        setTimeout(hideNavigationWithDelay, 0);
      }
    };
    
    // --- Implementasi Pinch-to-Zoom dan Panning ---
    function getDistance(touches) {
      return Math.hypot(
        touches[0].clientX - touches[1].clientX,
        touches[0].clientY - touches[1].clientY
      );
    }
    
    // Pinch-to-zoom (dua jari)
    function handlePinchStart(event) {
      if (event.touches.length === 2 && document.fullscreenElement) {
        isZooming = true;
        initialDistance = getDistance(event.touches);
        const img = event.target;
        initialScale = img.currentScale || 1;
      }
    }
    
    function handlePinchMove(event) {
      if (event.touches.length === 2 && isZooming) {
        event.preventDefault();
        const newDistance = getDistance(event.touches);
        const scale = (newDistance / initialDistance) * initialScale;
        const img = event.target;
        img.currentScale = scale;
        // Terapkan transformasi dengan offset yang sudah ada
        img.style.transform = `translate(${img.currentOffsetX}px, ${img.currentOffsetY}px) scale(${scale})`;
        isZoomed = scale !== 1;
      }
    }
    
    function handlePinchEnd() {
      isZooming = false;
      initialDistance = null;
    }
    
    // Panning (satu jari) untuk gambar yang sudah di-zoom
    function handlePanStart(event) {
      if (document.fullscreenElement && event.touches.length === 1) {
        const img = event.target;
        if (img.currentScale > 1) {
          isPanning = true;
          img.panStartX = event.touches[0].clientX;
          img.panStartY = event.touches[0].clientY;
          event.stopPropagation(); // Mencegah swipe carousel
        }
      }
    }
    
    function handlePanMove(event) {
      if (isPanning && event.touches.length === 1) {
        event.preventDefault();
        const img = event.target;
        const dx = event.touches[0].clientX - img.panStartX;
        const dy = event.touches[0].clientY - img.panStartY;
        const newOffsetX = (img.currentOffsetX || 0) + dx;
        const newOffsetY = (img.currentOffsetY || 0) + dy;
        img.style.transform = `translate(${newOffsetX}px, ${newOffsetY}px) scale(${img.currentScale})`;
      }
    }
    
    function handlePanEnd(event) {
      if (isPanning) {
        const img = event.target;
        const dx = event.changedTouches[0].clientX - img.panStartX;
        const dy = event.changedTouches[0].clientY - img.panStartY;
        img.currentOffsetX = (img.currentOffsetX || 0) + dx;
        img.currentOffsetY = (img.currentOffsetY || 0) + dy;
        isPanning = false;
      }
    }
    
    // Double-tap untuk reset zoom dan offset
    function handleDoubleTap(event) {
      const img = event.target;
      const currentTime = new Date().getTime();
      const tapLength = currentTime - lastTapTime;
    
      if (tapLength < 300 && document.fullscreenElement) { 
        if (isZoomed) {
          img.currentScale = 1;
          img.currentOffsetX = 0;
          img.currentOffsetY = 0;
          img.style.transform = "translate(0px, 0px) scale(1)";
          isZoomed = false;
        }
        event.preventDefault();
      }
      lastTapTime = currentTime;
    }
    
    // Handler untuk touchend agar double-tap tidak terganggu oleh pinch
    function handleTouchEnd(event) {
      if (isZooming) {
        isZooming = false;
        return;
      }
      clearTimeout(doubleTapTimeout);
      doubleTapTimeout = setTimeout(() => {
        handleDoubleTap(event);
      }, 50);
    }
    
    // Tambahkan event listener untuk setiap gambar
    images.forEach(img => {
      // Pinch events
      img.addEventListener('touchstart', handlePinchStart);
      img.addEventListener('touchmove', handlePinchMove);
      img.addEventListener('touchend', handlePinchEnd);
      // Panning events
      img.addEventListener('touchstart', handlePanStart);
      img.addEventListener('touchmove', handlePanMove);
      img.addEventListener('touchend', handlePanEnd);
      // Double-tap
      img.addEventListener('touchend', handleTouchEnd);
    });
    
  })();
</script>

</body>

</html>
